generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  USER
  ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum BookingStatus {
  PENDING_PAYMENT
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

model User {
  id           String      @id @default(uuid())
  name         String
  email        String      @unique
  phone        String?
  passwordHash String      @map("password_hash")
  role         UserRole    @default(USER)
  status       UserStatus  @default(ACTIVE)
  createdAt    DateTime    @default(now()) @map("created_at")
  updatedAt    DateTime    @updatedAt @map("updated_at")

  bookings     Booking[]
  reviews      Review[]

  @@index([email])
  @@map("users")
}

model Hotel {
  id          String   @id @default(uuid())
  name        String
  city        String
  address     String
  description String   @db.Text
  rating      Float    @default(0)
  latitude    Float?   @map("lat")
  longitude   Float?   @map("lng")
  mainImage   String?  @map("main_image")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  images      HotelImage[]
  amenities   HotelAmenity[]
  rooms       Room[]
  bookings    Booking[]
  reviews     Review[]

  @@index([city])
  @@index([rating])
  @@map("hotels")
}

model HotelImage {
  id       String @id @default(uuid())
  hotelId  String @map("hotel_id")
  imageUrl String @map("image_url")

  hotel    Hotel  @relation(fields: [hotelId], references: [id], onDelete: Cascade)

  @@index([hotelId])
  @@map("hotel_images")
}

model Amenity {
  id     String         @id @default(uuid())
  name   String         @unique

  hotels HotelAmenity[]

  @@map("amenities")
}

model HotelAmenity {
  hotelId   String @map("hotel_id")
  amenityId String @map("amenity_id")

  hotel     Hotel   @relation(fields: [hotelId], references: [id], onDelete: Cascade)
  amenity   Amenity @relation(fields: [amenityId], references: [id], onDelete: Cascade)

  @@id([hotelId, amenityId])
  @@map("hotel_amenities")
}

model Room {
  id            String   @id @default(uuid())
  hotelId       String   @map("hotel_id")
  name          String
  roomType      String   @map("room_type")
  capacity      Int
  pricePerNight Float    @map("price_per_night")
  totalRooms    Int      @map("total_rooms")
  description   String?  @db.Text
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  hotel         Hotel       @relation(fields: [hotelId], references: [id], onDelete: Cascade)
  images        RoomImage[]
  bookings      Booking[]

  @@index([hotelId])
  @@index([pricePerNight])
  @@map("rooms")
}

model RoomImage {
  id       String @id @default(uuid())
  roomId   String @map("room_id")
  imageUrl String @map("image_url")

  room     Room   @relation(fields: [roomId], references: [id], onDelete: Cascade)

  @@index([roomId])
  @@map("room_images")
}

model Booking {
  id            String        @id @default(uuid())
  userId        String        @map("user_id")
  hotelId       String        @map("hotel_id")
  roomId        String        @map("room_id")
  checkIn       DateTime      @map("check_in")
  checkOut      DateTime      @map("check_out")
  guests        Int
  roomsCount    Int           @map("rooms_count")
  totalAmount   Float         @map("total_amount")
  status        BookingStatus @default(PENDING_PAYMENT)
  paymentStatus PaymentStatus @default(PENDING) @map("payment_status")
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")

  user          User      @relation(fields: [userId], references: [id])
  hotel         Hotel     @relation(fields: [hotelId], references: [id])
  room          Room      @relation(fields: [roomId], references: [id])
  payment       Payment?

  @@index([userId])
  @@index([hotelId])
  @@index([roomId])
  @@index([checkIn, checkOut])
  @@index([status])
  @@map("bookings")
}

model Payment {
  id          String        @id @default(uuid())
  bookingId   String        @unique @map("booking_id")
  provider    String
  providerRef String?       @map("provider_ref")
  amount      Float
  currency    String        @default("USD")
  status      PaymentStatus @default(PENDING)
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")

  booking     Booking       @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@index([bookingId])
  @@map("payments")
}

model Review {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  hotelId   String   @map("hotel_id")
  rating    Int
  comment   String?  @db.Text
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  user      User     @relation(fields: [userId], references: [id])
  hotel     Hotel    @relation(fields: [hotelId], references: [id], onDelete: Cascade)

  @@index([hotelId])
  @@index([userId])
  @@map("reviews")
}
